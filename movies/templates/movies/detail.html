{% extends 'movies/base.html' %}

{% load bootstrap4 %}
{% load static %}

{% block content %}
<font color="#3E64E2">
  <h1 class="text-center" style="font-family: 'Do Hyeon';">ì˜í™” ì •ë³´ ì¡°íšŒ</h1>
</font>
<br>

<br>

<div class="card mb-3">
  <div class="row no-gutters">
    <div class="col-md-4">
      <img src="https://image.tmdb.org/t/p/original{{ movie.poster_url }}" class="card-img"
        alt="{{ movie.name }}ì˜ í¬ìŠ¤í„° ì´ë¯¸ì§€">
    </div>
    <div class="col-md-8">
      <div class="card-body">
        <h5 class="card-title"><b>{{ movie.name }}</b></h5>
        <p class="card-text">
          <ul>
            <li>director : {{ movie.director }}</li><br>
            <li>genre : {% for genre in movie.genre_id.all %}
              {{ genre.name }}
              {% endfor %}</li><br>
            <li>rating : {{ movie.audience_rating }}</li><br>
            {% if movie.audience != 0 %}
            <li>audience : {{ movie.audience }}</li>
            {% endif %}
            <li>description : {{ movie.description }}</li>
            <li>opening date : {{ movie.release_date }}</li>
          </ul>
        </p>
        <p class="card-text"><small class="text-muted">cf)ê´€ê°ìˆ˜ê°€ 0ì¸ ê²½ìš°ëŠ” audience í•­ëª© í‘œì‹œë¥¼ ì•ˆí•˜ê²Œ ì„¤ì •í•¨</small></p>
      </div>
    </div>
  </div>
</div>
  {% if user in movie.like_users.all %}
  <button class="btn btn-warning like-button" data-id="{{ movie.pk }}">ì¢‹ì•„ìš” ì·¨ì†Œ...</button>
  {% else %}
  <button class="btn btn-warning like-button" data-id="{{ movie.pk }}">ì¢‹ì•„ìš”!</button>
  {% endif %}
<span id="like-count-{{ movie.pk }}" style="color: white;">{{ movie.like_users.all|length }} ëª…ì´ ì¢‹ì•„í•¨.</span>
<br>
{% include 'movies/_youtube.html' %}
<br>
<h3 class="text-center" style="color: white; text-shadow: 0 0 12px black;">ì£¼ìš” ì¶œì—°ì§„</h3>

{% include 'movies/_actors.html' %}

{% comment %} <!--Carousel Wrapper-->
<div id="multi-item-example" class="carousel slide carousel-multi-item" data-ride="carousel">

  <!--Controls-->
  <div class="controls-top">
    <a class="btn-floating" href="#multi-item-example" data-slide="prev"><i class="fa fa-chevron-left"></i></a>
    <a class="btn-floating" href="#multi-item-example" data-slide="next"><i class="fa fa-chevron-right"></i></a>
  </div>
  <!--/.Controls-->

  <!--Indicators-->
  <ol class="carousel-indicators">
    <li data-target="#multi-item-example" data-slide-to="0" class="active"></li>
    <li data-target="#multi-item-example" data-slide-to="1"></li>
    <li data-target="#multi-item-example" data-slide-to="2"></li>
  </ol>
  <!--/.Indicators-->

  <!--Slides-->
  <div class="carousel-inner" role="listbox">

    <!--First slide-->
    <div class="carousel-item active">

      <div class="row">
        <div class="col-md-4">
          <div class="card mb-2">
            <img class="card-img-top" src="https://mdbootstrap.com/img/Photos/Horizontal/Nature/4-col/img%20(34).jpg"
              alt="Card image cap">
            <div class="card-body">
              <h4 class="card-title">Card title</h4>
              <p class="card-text">Some quick example text to build on the card title and make up the bulk of the
                card's content.</p>
              <a class="btn btn-primary">Button</a>
            </div>
          </div>
        </div>

        <div class="col-md-4 clearfix d-none d-md-block">
          <div class="card mb-2">
            <img class="card-img-top" src="https://mdbootstrap.com/img/Photos/Horizontal/Nature/4-col/img%20(18).jpg"
              alt="Card image cap">
            <div class="card-body">
              <h4 class="card-title">Card title</h4>
              <p class="card-text">Some quick example text to build on the card title and make up the bulk of the
                card's content.</p>
              <a class="btn btn-primary">Button</a>
            </div>
          </div>
        </div>

        <div class="col-md-4 clearfix d-none d-md-block">
          <div class="card mb-2">
            <img class="card-img-top" src="https://mdbootstrap.com/img/Photos/Horizontal/Nature/4-col/img%20(35).jpg"
              alt="Card image cap">
            <div class="card-body">
              <h4 class="card-title">Card title</h4>
              <p class="card-text">Some quick example text to build on the card title and make up the bulk of the
                card's content.</p>
              <a class="btn btn-primary">Button</a>
            </div>
          </div>
        </div>
      </div>

    </div>
    <!--/.First slide-->

    <!--Second slide-->
    <div class="carousel-item">

      <div class="row">
        <div class="col-md-4">
          <div class="card mb-2">
            <img class="card-img-top" src="https://mdbootstrap.com/img/Photos/Horizontal/City/4-col/img%20(60).jpg"
              alt="Card image cap">
            <div class="card-body">
              <h4 class="card-title">Card title</h4>
              <p class="card-text">Some quick example text to build on the card title and make up the bulk of the
                card's content.</p>
              <a class="btn btn-primary">Button</a>
            </div>
          </div>
        </div>

        <div class="col-md-4 clearfix d-none d-md-block">
          <div class="card mb-2">
            <img class="card-img-top" src="https://mdbootstrap.com/img/Photos/Horizontal/City/4-col/img%20(47).jpg"
              alt="Card image cap">
            <div class="card-body">
              <h4 class="card-title">Card title</h4>
              <p class="card-text">Some quick example text to build on the card title and make up the bulk of the
                card's content.</p>
              <a class="btn btn-primary">Button</a>
            </div>
          </div>
        </div>

        <div class="col-md-4 clearfix d-none d-md-block">
          <div class="card mb-2">
            <img class="card-img-top" src="https://mdbootstrap.com/img/Photos/Horizontal/City/4-col/img%20(48).jpg"
              alt="Card image cap">
            <div class="card-body">
              <h4 class="card-title">Card title</h4>
              <p class="card-text">Some quick example text to build on the card title and make up the bulk of the
                card's content.</p>
              <a class="btn btn-primary">Button</a>
            </div>
          </div>
        </div>
      </div>

    </div>
    <!--/.Second slide-->

    <!--Third slide-->
    <div class="carousel-item">

      <div class="row">
        <div class="col-md-4">
          <div class="card mb-2">
            <img class="card-img-top" src="https://mdbootstrap.com/img/Photos/Horizontal/Food/4-col/img%20(53).jpg"
              alt="Card image cap">
            <div class="card-body">
              <h4 class="card-title">Card title</h4>
              <p class="card-text">Some quick example text to build on the card title and make up the bulk of the
                card's content.</p>
              <a class="btn btn-primary">Button</a>
            </div>
          </div>
        </div>

        <div class="col-md-4 clearfix d-none d-md-block">
          <div class="card mb-2">
            <img class="card-img-top" src="https://mdbootstrap.com/img/Photos/Horizontal/Food/4-col/img%20(45).jpg"
              alt="Card image cap">
            <div class="card-body">
              <h4 class="card-title">Card title</h4>
              <p class="card-text">Some quick example text to build on the card title and make up the bulk of the
                card's content.</p>
              <a class="btn btn-primary">Button</a>
            </div>
          </div>
        </div>

        <div class="col-md-4 clearfix d-none d-md-block">
          <div class="card mb-2">
            <img class="card-img-top" src="https://mdbootstrap.com/img/Photos/Horizontal/Food/4-col/img%20(51).jpg"
              alt="Card image cap">
            <div class="card-body">
              <h4 class="card-title">Card title</h4>
              <p class="card-text">Some quick example text to build on the card title and make up the bulk of the
                card's content.</p>
              <a class="btn btn-primary">Button</a>
            </div>
          </div>
        </div>
      </div>

    </div>
    <!--/.Third slide-->

  </div>
  <!--/.Slides-->

</div>
<!--/.Carousel Wrapper--> {% endcomment %}


<br>
{% if user.is_authenticated %}
<form action="{% url 'movies:comments_create' movie.pk %}" method="POST">
  {% csrf_token %}
  {{ comment_form }}
  <input class="btn btn-success btn-sm comment-create-button" type="submit" value="ëŒ“ê¸€ ì‘ì„±">
</form>
{% else %}
<a href="{% url 'accounts:login' %}">[ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸í•˜ì„¸ìš”]</a>
{% endif %}

<hr>
<p><b>{{ comments|length }}ê°œì˜ ëŒ“ê¸€</b></p>
<!---->
<div class="card-columns">
  {% for comment in comments %}
  <div class="card">
    <div class="card-body">
      <p>ì•„ì´ë”” : <a href="{% url 'accounts:detail' comment.user.pk %}">{{ comment.user }}</a></p>
      {% if comment.score == 10 %}
      <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ•</h5>
      {% elif comment.score == 9 %}
      <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ—</h5>
      {% elif comment.score == 8 %}
      <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ‘</h5>
      {% elif comment.score == 7 %}
      <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ—ğŸŒ‘</h5>
      {% elif comment.score == 6 %}
      <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ‘ğŸŒ‘</h5>
      {% elif comment.score == 5 %}
      <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ—ğŸŒ‘ğŸŒ‘</h5>
      {% elif comment.score == 4 %}
      <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ‘ğŸŒ‘ğŸŒ‘</h5>
      {% elif comment.score == 3 %}
      <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ—ğŸŒ‘ğŸŒ‘ğŸŒ‘</h5>
      {% elif comment.score == 2 %}
      <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ‘ğŸŒ‘ğŸŒ‘ğŸŒ‘</h5>
      {% elif comment.score == 1 %}
      <h5 class="card-title">í‰ì  : ğŸŒ—ğŸŒ‘ğŸŒ‘ğŸŒ‘ğŸŒ‘</h5>
      {% endif %}
      <p class="card-text">ëŒ“ê¸€ : {{ comment.content }}</p>
      {% if request.user == comment.user %}
      <form action="{% url  'movies:comments_delete' movie.pk comment.pk %}" method="POST" style="display: inline;">
        {% csrf_token %}
        <input class="btn btn-danger btn-sm comment-delete-button" type="submit" value="DELETE">
      </form>
      {% endif %}
    </div>
  </div>
  {% empty %}
  <p><b>ëŒ“ê¸€ì´ ì—†ì–´ìš”...</b></p>
  {% endfor %}
  <br>
</div>

<script>
  const likebuttons = document.querySelectorAll('.like-button')
  likebuttons.forEach(button => {
    button.addEventListener('click', function(event) {
      const movieId = event.target.dataset.id
      axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest'
      axios.defaults.xsrfCookieName = 'csrftoken'
      axios.defaults.xsrfHeaderName = 'X-CSRFToken'
      axios.post(`/movies/${movieId}/like/`)
      .then(response => {
        document.querySelector(`#like-count-${movieId}`).innerText = response.data.count
        if (response.data.liked) {
          document.querySelector('.like-button').innerText = 'ì¢‹ì•„ìš” ì·¨ì†Œ...'
        } else {
          document.querySelector('.like-button').innerText = 'ì¢‹ì•„ìš”!'
        }
        
      })
      .catch(error => {
        console.log(error)
      })
    })
  })
</script>

{% endblock  %}