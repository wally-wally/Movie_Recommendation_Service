{% extends 'movies/base.html' %}

{% load bootstrap4 %}
{% load static %}

{% block content %}
<font color="#3E64E2">
  <h1 class="text-center" style="font-family: 'Do Hyeon'; color: #B7E8FF; text-shadow: 3px 3px 8px white;">ì˜í™” ì •ë³´ ì¡°íšŒ</h1>
</font>
<br>
<br>

<div class="card mb-3">
  <div class="card-header" style="background-color:#E2DAE7;">
    <h2 class="movie-title" style="font-family: 'Jua'; color: #5744A5;"><b>{{ movie.name }}</b></h2>
  </div>
  <div class="row no-gutters" style="max-width: 10000px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">
    <div class="col-md-4">
      <img src="https://image.tmdb.org/t/p/original{{ movie.poster_url }}" class="card-img" alt="{{movie.name}}">
    </div>
    <div class="col-md-8" style="font-family: 'Gothic A1', sans-serif;">
      <div class="card-body">
        <p>ê°ë… ì´ë¦„ : <a href="https://www.google.com/search?q={{movie.director}}" target="_blank">{{movie.director}}</a>
        </p>
        <hr>
        <p>ì¥ë¥´ :
          {% for genre in movie.genre_id.all %}
          {{ genre.name }}
          {% endfor %}
        </p>
        <hr>
        {% if movie.audience != 0 %}
        <p>ê´€ê°ìˆ˜ : {{ movie.audience }}</p>
        <hr>
        {% endif %}
        <p>ê´€ëŒë“±ê¸‰ : {{ movie.audience_rating }}</p>
        <hr>
        <p>ì„¤ëª… : {{ movie.description }}</p>
        <hr>
        <p>ê°œë´‰ì¼ : {{ movie.release_date }}</p>
        <hr>
        <p class="card-text"><small class="text-muted">cf)ê´€ê°ìˆ˜ê°€ 0ì¸ ê²½ìš°ëŠ” 'ê´€ê°ìˆ˜' í•­ëª© í‘œì‹œë¥¼ ì•ˆí•˜ê²Œ ì„¤ì •í•¨</small></p>
        <hr>
        {% if user in movie.like_users.all %}
        <button class="btn btn-warning btn-lg like-button" style="font-family: 'Nanum Pen Script', cursive;"
          data-id="{{ movie.pk }}">ì¢‹ì•„ìš” ì·¨ì†Œ...</button>
        {% else %}
        <button class="btn btn-warning btn-lg like-button" style="font-family: 'Nanum Pen Script', cursive;"
          data-id="{{ movie.pk }}">ì¢‹ì•„ìš”!</button>
        {% endif %}
        <span style="font-size: 1.5rem; font-family: 'Gothic A1', sans-serif;"> Like count :</span>
        <span id="like-count-{{ movie.pk }}" style="font-size: 1.5rem; font-family: 'Gothic A1', sans-serif;">
          {{ movie.like_users.all|length }}</span>
      </div>
    </div>
  </div>
</div>
<br>

{% include 'movies/_youtube.html' %}

<h2 class="text-center" style="font-family: 'Do Hyeon'; color: #B7E8FF; text-shadow: 0 0 12px black;">ì£¼ìš” ì¶œì—°ì§„</h2>
{% include 'movies/_actors.html' %}

<br>
<br>

<div class="jumbotron">
  <h1 class="display-4" style="font-family: 'Jua';"><b>{{ comments|length }}ê°œì˜ ëŒ“ê¸€</b>!</h1>
  {% if user.is_authenticated %}
  <form action="{% url 'movies:comments_create' movie.pk %}" method="POST" style="font-family: 'Gothic A1', sans-serif;">
    {% csrf_token %}
    {{ comment_form }}
    <input class="btn btn-success btn-sm comment-create-button" type="submit" value="ëŒ“ê¸€ ì‘ì„±">
  </form>
  {% else %}
  <a style="font-family: 'Poor Story';" href="{% url 'accounts:login' %}">[ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸í•˜ì„¸ìš”]</a>
  {% endif %}
  <hr class="my-4">
  <div class="card-columns">
    {% for comment in comments %}
    <div class="card">
      <div class="card-body" style="font-family: 'Gothic A1', sans-serif;">
        <p>ì•„ì´ë”” : <a href="{% url 'accounts:detail' comment.user.pk %}">{{ comment.user }}</a></p>
        {% if comment.score == 10 %}
        <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ•</h5>
        {% elif comment.score == 9 %}
        <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ—</h5>
        {% elif comment.score == 8 %}
        <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ‘</h5>
        {% elif comment.score == 7 %}
        <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ—ğŸŒ‘</h5>
        {% elif comment.score == 6 %}
        <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ•ğŸŒ‘ğŸŒ‘</h5>
        {% elif comment.score == 5 %}
        <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ—ğŸŒ‘ğŸŒ‘</h5>
        {% elif comment.score == 4 %}
        <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ•ğŸŒ‘ğŸŒ‘ğŸŒ‘</h5>
        {% elif comment.score == 3 %}
        <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ—ğŸŒ‘ğŸŒ‘ğŸŒ‘</h5>
        {% elif comment.score == 2 %}
        <h5 class="card-title">í‰ì  : ğŸŒ•ğŸŒ‘ğŸŒ‘ğŸŒ‘ğŸŒ‘</h5>
        {% elif comment.score == 1 %}
        <h5 class="card-title">í‰ì  : ğŸŒ—ğŸŒ‘ğŸŒ‘ğŸŒ‘ğŸŒ‘</h5>
        {% endif %}
        <p class="card-text">ëŒ“ê¸€ : {{ comment.content }}</p>
        {% if request.user == comment.user %}
        <a class="btn btn-warning btn-sm" href="{% url 'movies:comments_update' movie.pk comment.pk %}" style="display: inline;">ìˆ˜ì •</a>
        <form action="{% url  'movies:comments_delete' movie.pk comment.pk %}" method="POST" style="display: inline; font-family: 'Gothic A1', sans-serif;">
          {% csrf_token %}
          <input class="btn btn-danger btn-sm comment-delete-button" type="submit" value="DELETE">
        </form>
        {% endif %}
      </div>
    </div>
    {% empty %}
    <h3 style="font-family: 'Poor Story', cursive;"><b>ëŒ“ê¸€ì´ ì—†ì–´ìš”...</b></h3>
    {% endfor %}
    <br>
  </div>


</div>

<script>
  const likebuttons = document.querySelectorAll('.like-button')
  likebuttons.forEach(button => {
    button.addEventListener('click', function (event) {
      const movieId = event.target.dataset.id
      axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest'
      axios.defaults.xsrfCookieName = 'csrftoken'
      axios.defaults.xsrfHeaderName = 'X-CSRFToken'
      axios.post(`/movies/${movieId}/like/`)
        .then(response => {
          document.querySelector(`#like-count-${movieId}`).innerText = response.data.count
          if (response.data.liked) {
            document.querySelector('.like-button').innerText = 'ì¢‹ì•„ìš” ì·¨ì†Œ...'
          } else {
            document.querySelector('.like-button').innerText = 'ì¢‹ì•„ìš”!'
          }

        })
        .catch(error => {
          console.log(error)
        })
    })
  })
</script>

{% endblock  %}